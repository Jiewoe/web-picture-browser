<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
    <script src="/static/js/color-modes.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.118.2">
    <title>Web Album Browser</title>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link rel="stylesheet" href="/static/css/viewer.min.css">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/daterangepicker.css" rel="stylesheet">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .btn-bd-primary {
            --bd-violet-bg: #712cf9;
            --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

            --bs-btn-font-weight: 600;
            --bs-btn-hover-bg: #6528e0;
            --bs-btn-hover-border-color: #6528e0;
            --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);


            --bs-btn-active-bg: #5a23c8;
            --bs-btn-active-border-color: #5a23c8;
        }

        .bd-mode-toggle {
            z-index: 1500;
        }

        .bd-mode-toggle .dropdown-menu .active .bi {
            display: block !important;
        }
    </style>


</head>

<body>
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
        <symbol id="check2" viewBox="0 0 16 16">
            <path
                d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
        </symbol>
        <symbol id="circle-half" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" />
        </symbol>
        <symbol id="moon-stars-fill" viewBox="0 0 16 16">
            <path
                d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
            <path
                d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z" />
        </symbol>
        <symbol id="sun-fill" viewBox="0 0 16 16">
            <path
                d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
        </symbol>
    </svg>

    <div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
        <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button"
            aria-expanded="false" data-bs-toggle="dropdown" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active" width="1em" height="1em">
                <use href="#circle-half"></use>
            </svg>
            <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme-text">
            <li>
                <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light"
                    aria-pressed="false">
                    <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
                        <use href="#sun-fill"></use>
                    </svg>
                    Light
                    <svg class="bi ms-auto d-none" width="1em" height="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
            <li>
                <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"
                    aria-pressed="false">
                    <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
                        <use href="#moon-stars-fill"></use>
                    </svg>
                    Dark
                    <svg class="bi ms-auto d-none" width="1em" height="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
            <li>
                <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto"
                    aria-pressed="true">
                    <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
                        <use href="#circle-half"></use>
                    </svg>
                    Auto
                    <svg class="bi ms-auto d-none" width="1em" height="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
        </ul>
    </div>

    <header data-bs-theme="dark">
        <div class="collapse text-bg-dark" id="navbarHeader">
            <div class="container">
                <div class="row">
                    <div class="col-sm-8 col-md-7 py-4">
                        <h4>About</h4>
                        <p class="text-body-secondary">This is a photo browsing webpage. You can upload files to this
                            webpage through the file transfer portal on the right. After refreshing the page, you can
                            see the uploaded pictures below. Two options are provided below. You can choose the picture
                            browsing method through different option combinations.</p>
                    </div>
                    <div class="col-sm-4 offset-md-1 py-4">
                        <form id="upload-form">
                            <div class="mb-3">
                                <label class="form-label" for="customFile">Upload Image</label>
                                <input id="image-file" type="file" class="form-control" multiple>
                            </div>
                            <div class="mb-3">
                                <label for="validationServer04" class="form-label">Shot Location</label>
                                <select class="form-select" id="city-selector" required>
                                  <option selected disabled value="unknown location">Unknown Location</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label" for="customFile">Shot Date</label>
                                        <input id="shot-date" type="text" name="single-date-picker" class="form-control">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" for="customFile">Title</label>
                                        <input id="title" type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="row justify-content-center">
                                    <div class="col-md-3">
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="navbar navbar-dark bg-dark shadow-sm">
            <div class="container">
                <a href="#" class="navbar-brand d-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                        stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="me-2"
                        viewBox="0 0 24 24">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                        <circle cx="12" cy="13" r="4" />
                    </svg>
                    <strong>Album</strong>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader"
                    aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </header>

    <main>

        <section class="py-5 text-center container">
            <div class="row py-lg-5">
                <div class="col-lg-6 col-md-8 mx-auto">
                    <h1 class="fw-light">Album Browser</h1>
                    <p class="lead text-body-secondary">The album web browser can easily manage the photos stored on
                        your device and supports a multi-functional photo browser.</p>
                    <div class="row justify-content-center">
                        <div class="col-md-5">
                            <select class="form-select" id="sort-time" required>
                                <option value="descend">sort by...</option>
                                <option value="descend">time descend</option>
                                <option value="ascend">time ascend</option>
                            </select>
                        </div>

                        <div class="col-md-5">
                            <select class="form-select" id="sort-city" required>
                                <option value="all">select location...</option>
                                <option value="all">all regions</option>
                                <option value="other">other region</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="album py-5 bg-body-tertiary">
            <div class="container">

                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="picture-container">
                </div>
            </div>
        </div>

    </main>

    <footer class="text-body-secondary py-5">
        <div class="container">
            <p class="float-end mb-1">
                <a href="#">Back to top</a>
            </p>
            <p class="mb-1">Album Browser is built on &copy;Bootstrap, and the author is a student of CQU.</p>
            <p class="mb-0">More author's projects? <a href="https://github.com/Jiewoe">Visit author's github homepage.</a> </p>
        </div>
    </footer>
    <script src="/static/js/bootstrap.bundle.min.js"></script>

</body>
<script src="/static/js/viewer.min.js"></script>
<script src="/static/js/code.jquery.com_jquery-3.7.1.min.js"></script>
<script src="/static/js/datepicker.js"></script>
<script src="/static/js/daterangepicker.js"></script>

<script>
    var time_sort_mode = 'descend';
    var city_sort_mode = 'all';
    var cities = {{ data.cities | safe }};
    var pictures = {{ data.pictures | safe }};
    var viewers = {};
    var all_cities = null;

    function view(dom) {
        let name = dom.getAttribute('id').split(' ')[0];
        if (viewers.hasOwnProperty(name)) {
            viewers[name].show();
        } else {
            let viewer = new Viewer(document.getElementById(name), {
                navbar: false
            });
            viewer.show();
            viewers[name] = viewer;
        }
    }

    function del(dom) {
        let name = dom.getAttribute('id').split(' ')[0];
        let id = dom.getAttribute('id').split(' ')[2];
        let data = {
            'id': id
        }

        $.ajax({
            type: "GET",
            url: "/delete/",
            data: data,
            success: function (response) {
                if (response.code === 0) {
                    let ele = $('#picture-container>div');
                    for(let i=0; i<ele.length; i++) {
                        if (ele[i].id.split(' ')[0] === name) {
                            ele.eq(i).remove();
                            break;
                        }
                    }
                    for (let i=0; i<all_cities.length; i++) {
                        if (all_cities[i].id.split(' ')[0] === name) {
                            all_cities.not(':eq('+ i.toString() +')');
                            break;
                        }
                    }
                }
            },
            error: function (response) {

            }
        });
    }

    $(document).ready(function () {
        var container = $('#picture-container');

        for (let i=0; i<cities.length; i++) {
            let e1 = document.createElement('option');
            e1.setAttribute('value', cities[i]);
            e1.innerHTML = cities[i];

            let e2 = document.createElement('option');
            e2.setAttribute('value', cities[i]);
            e2.innerHTML = cities[i];

            $('#sort-city').append(e1);
            $('#city-selector').append(e2);
        }

        for (let i=0; i<pictures.length; i++) {
            let col_div = document.createElement('div');
            let card_div = document.createElement('div');
            let img_div = document.createElement('div');
            let img = document.createElement('img');
            let card_body_div = document.createElement('div');
            let footer_div = document.createElement('div');
            let p = document.createElement('p');
            let view_button = document.createElement('button');
            let del_button = document.createElement('button');
            let btn_group = document.createElement('div');
            let small = document.createElement('small');

            col_div.setAttribute('id', 'picture'+i.toString()+' '+pictures[i].address);
            col_div.setAttribute('class', 'col');
            card_div.setAttribute('class', 'card shadow-sm');
            card_body_div.setAttribute('class', 'card-body');
            footer_div.setAttribute('class', 'd-flex justify-content-between align-items-center');
            p.setAttribute('class', 'card-text');
            view_button.setAttribute('class', 'btn btn-sm btn-outline-secondary');
            del_button.setAttribute('class', 'btn btn-sm btn-outline-secondary');
            small.setAttribute('class', 'text-body-secondary');
            btn_group.setAttribute('class', 'btn-group');

            view_button.setAttribute('id', 'picture'+i+' button');
            view_button.setAttribute('type', 'button');
            view_button.setAttribute('onclick', 'view(this)');
            view_button.innerHTML = 'View';

            del_button.setAttribute('id', 'picture'+i+' del_button '+pictures[i].key);
            del_button.setAttribute('type', 'button');
            del_button.setAttribute('onclick', 'del(this)');
            del_button.innerHTML = 'Delete';

            img.setAttribute('width', '100%');
            img.setAttribute('height', '225px');
            img.setAttribute('id', 'picture'+i);
            img.setAttribute('data-original', pictures[i].path);
            img.setAttribute('src', pictures[i].path);
            img.setAttribute('alt', 'picture'+i);

            small.innerHTML = pictures[i].shot_time + ' | ' + pictures[i].address;
            p.innerHTML = pictures[i].title;

            col_div.appendChild(card_div);
            card_div.appendChild(img_div);
            card_div.appendChild(card_body_div);

            img_div.appendChild(img);
            card_body_div.appendChild(p);
            card_body_div.appendChild(footer_div);
            btn_group.appendChild(view_button);
            btn_group.appendChild(del_button);
            footer_div.appendChild(btn_group);
            footer_div.appendChild(small);

            container.append(col_div);
        }

        all_cities = $('#picture-container>div');

        $('#upload-form').submit(function (e) {
            e.preventDefault();

            const files = $('#image-file').prop('files');
            const dataList = new FormData();
            for (let i=0; i<files.length; i++) {
                dataList.append('file'+i.toString(), files[i]);
            }
            dataList.append('location', $('#city-selector option:selected').val());
            dataList.append('shot-date', $('#shot-date').val());
            dataList.append('title', $('#title').val());

            $.ajax({
                //请求方式
                type : "POST",
                //请求的服务器地址
                url : "/upload/",
                data : dataList,
                processData: false,
                contentType: false,
                //请求成功的回调函数
                success : function(result) {
                    if (result.code === 0) {
                        alert('Upload successfully! Please refresh the page. ');
                        $('#upload-form')[0].reset();
                    }
                },
                //请求失败的回调函数，包含具体的错误信息
                error : function(e){
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        });

        $('#sort-time').change(function () {
            let selected = $('#sort-time option:selected').val();
            sort_col(selected);
        });

        $('#sort-city').change(function () {
            let selected = $('#sort-city option:selected').val();
            change_city(selected);
        });

        var change_city = function (city) {
            if (city_sort_mode === city)
                return;
            if (city === 'all') {
                container.empty().append(all_cities);
                city_sort_mode = city;
                return;
            }
            var eles = [];
            for (let i=0; i<all_cities.length; i++) {
                if (all_cities[i].id.split(' ')[1] === city) {
                    eles.push(all_cities[i]);
                }
            }
            container.empty().append(eles);
            city_sort_mode = city;
        }
        var sort_col = function (order) {
            if (order === time_sort_mode)
                return
            if (order === 'descend')
                var ele = $('#picture-container>div').sort(descend);
            else
                var ele = $('#picture-container>div').sort(ascend);
            container.empty().append(ele);
            time_sort_mode = order;
        }
        var descend = function (a, b) {
            var idA = a.id;
            var idB = b.id;

            if (idA > idB) {
                return 1;
            } else if (idA < idB) {
                return -1;
            } else {
                return 0;
            }
        }
        var ascend = function (a, b) {
            var idA = a.id;
            var idB = b.id;

            if (idA < idB) {
                return 1;
            } else if (idA > idB) {
                return -1;
            } else {
                return 0;
            }
        }
    });

</script>

</html>